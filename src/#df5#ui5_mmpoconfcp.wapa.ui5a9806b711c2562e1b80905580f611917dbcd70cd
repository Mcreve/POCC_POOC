sap.ui.define([                                                                                                                                                                                                                                                
	"sap/ui/core/mvc/Controller",                                                                                                                                                                                                                                 
	"sap/ui/model/Filter",                                                                                                                                                                                                                                        
	"com/delaware/df5-mm-po-confirm-cp/model/formatter",                                                                                                                                                                                                          
	"com/delaware/df5-mm-po-confirm-cp/model/GenericElements",                                                                                                                                                                                                    
	"sap/m/MessageBox"                                                                                                                                                                                                                                            
], function (Controller, Filter, formatter, GenericElements, MessageBox) {                                                                                                                                                                                     
	"use strict";                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
	return Controller.extend("com.delaware.df5-mm-po-confirm-cp.controller.Master", {                                                                                                                                                                             
                                                                                                                                                                                                                                                               
		oFormatter: formatter,                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
		onInit: function () {                                                                                                                                                                                                                                        
			this.getView().getModel("TempModel").setProperty("/Locations", []);                                                                                                                                                                                         
			this.getView().getModel("TempModel").setProperty("/Prices", []);                                                                                                                                                                                            
			this.getView().getModel("TempModel").setProperty("/OriginalValues", []);                                                                                                                                                                                    
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onStoreLocChange: function (oEvent) {                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
			let oSource = oEvent.getSource(),                                                                                                                                                                                                                           
				sValue = oSource.getValue();                                                                                                                                                                                                                               
			let bOriginalValue = false;                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
			if (sValue.length < 4) {                                                                                                                                                                                                                                    
				GenericElements.showDialog(this.getView().getModel("i18n").getResourceBundle().getText("Error"), this.getView().getModel("i18n").getResourceBundle()                                                                                                       
					.getText("InvalidLgortLength"), "OK", "Error");                                                                                                                                                                                                           
				oEvent.getSource().setValue(oEvent.getSource().getBindingContext().getObject().StorageLocation);                                                                                                                                                           
			} else {                                                                                                                                                                                                                                                    
				let oObject = oSource.getBindingContext().getObject();                                                                                                                                                                                                     
				let aFilters = [];                                                                                                                                                                                                                                         
				let aFiltersLgort = [];                                                                                                                                                                                                                                    
				aFiltersLgort.push(new Filter({                                                                                                                                                                                                                            
					filters: [                                                                                                                                                                                                                                                
						new sap.ui.model.Filter('Plant', sap.ui.model.FilterOperator.EQ, oObject.Plant),                                                                                                                                                                         
						new sap.ui.model.Filter('Product', sap.ui.model.FilterOperator.EQ, oObject.Material)                                                                                                                                                                     
					],                                                                                                                                                                                                                                                        
					and: true                                                                                                                                                                                                                                                 
				}));                                                                                                                                                                                                                                                       
				let aTempData = this.getView().getModel("TempModel").getProperty("/Locations");                                                                                                                                                                            
				let aOriginData = this.getView().getModel("TempModel").getProperty("/OriginalValues");                                                                                                                                                                     
				let sString = `S${oObject.PurchaseOrder}${oObject.PurchaseOrderLine}`;                                                                                                                                                                                     
				if (aOriginData.length > 0) {                                                                                                                                                                                                                              
					aOriginData.forEach((data) => {                                                                                                                                                                                                                           
						if (data.PO === sString && data.SLoc === sValue) {                                                                                                                                                                                                       
							bOriginalValue = true;                                                                                                                                                                                                                                  
						}                                                                                                                                                                                                                                                        
					});                                                                                                                                                                                                                                                       
				} else {                                                                                                                                                                                                                                                   
					aOriginData.push({                                                                                                                                                                                                                                        
						PO: sString,                                                                                                                                                                                                                                             
						SLoc: oObject.StorageLocation                                                                                                                                                                                                                            
					});                                                                                                                                                                                                                                                       
				}                                                                                                                                                                                                                                                          
				if (!bOriginalValue) {                                                                                                                                                                                                                                     
					aOriginData.push({                                                                                                                                                                                                                                        
						PO: sString,                                                                                                                                                                                                                                             
						SLoc: oObject.StorageLocation                                                                                                                                                                                                                            
					});                                                                                                                                                                                                                                                       
				}                                                                                                                                                                                                                                                          
				aFilters.push(new Filter({                                                                                                                                                                                                                                 
					filters: [                                                                                                                                                                                                                                                
						new sap.ui.model.Filter('PurchaseOrder', sap.ui.model.FilterOperator.EQ, oObject.PurchaseOrder),                                                                                                                                                         
						new sap.ui.model.Filter('PurchaseOrderLine', sap.ui.model.FilterOperator.EQ, oObject.PurchaseOrderLine)                                                                                                                                                  
					],                                                                                                                                                                                                                                                        
					and: true                                                                                                                                                                                                                                                 
				}));                                                                                                                                                                                                                                                       
				this.getData("/xDF5xC_PRODUCTSTORAGELOC_VH", aFiltersLgort)                                                                                                                                                                                                
					.then((oData) => {                                                                                                                                                                                                                                        
						let aData = [];                                                                                                                                                                                                                                          
						oData.results.forEach((result) => {                                                                                                                                                                                                                      
							aData.push(result.StorageLocation)                                                                                                                                                                                                                      
						})                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
						if (aData.includes(sValue)) {                                                                                                                                                                                                                            
							return this.getData("/xDF5xC_POCONF_LIST", aFilters)                                                                                                                                                                                                    
						} else {                                                                                                                                                                                                                                                 
							oSource.setValue(oSource.getBindingContext().getObject().StorageLocation);                                                                                                                                                                              
							throw new Error(this.getView().getModel("i18n").getResourceBundle().getText("StorageLocNotCorrect"));                                                                                                                                                   
						}                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
					})                                                                                                                                                                                                                                                        
					.then((oData) => {                                                                                                                                                                                                                                        
						oData.results.forEach((line) => {                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
							this.getView().getModel().setProperty(                                                                                                                                                                                                                  
								`/xDF5xC_POCONF_LIST(PurchaseOrder='${line.PurchaseOrder}',PurchaseOrderLine='${line.PurchaseOrderLine}',SupplierConfirmation='${line.SupplierConfirmation}')` +                                                                                       
								"/StorageLocation", sValue);                                                                                                                                                                                                                           
							if (bOriginalValue) {                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
								this.getView().getModel().setProperty(                                                                                                                                                                                                                 
									`/xDF5xC_POCONF_LIST(PurchaseOrder='${line.PurchaseOrder}',PurchaseOrderLine='${line.PurchaseOrderLine}',SupplierConfirmation='${line.SupplierConfirmation}')` +                                                                                      
									"/TempStoreLoc", "None");                                                                                                                                                                                                                             
							} else {                                                                                                                                                                                                                                                
								this.getView().getModel().setProperty(                                                                                                                                                                                                                 
									`/xDF5xC_POCONF_LIST(PurchaseOrder='${line.PurchaseOrder}',PurchaseOrderLine='${line.PurchaseOrderLine}',SupplierConfirmation='${line.SupplierConfirmation}')` +                                                                                      
									"/TempStoreLoc", "Warning");                                                                                                                                                                                                                          
							}                                                                                                                                                                                                                                                       
							if (!aTempData.includes(                                                                                                                                                                                                                                
									`/xDF5xC_POCONF_LIST(PurchaseOrder='${line.PurchaseOrder}',PurchaseOrderLine='${line.PurchaseOrderLine}',SupplierConfirmation='${line.SupplierConfirmation}')`                                                                                        
								)) {                                                                                                                                                                                                                                                   
								aTempData.push(                                                                                                                                                                                                                                        
									`/xDF5xC_POCONF_LIST(PurchaseOrder='${line.PurchaseOrder}',PurchaseOrderLine='${line.PurchaseOrderLine}',SupplierConfirmation='${line.SupplierConfirmation}')`                                                                                        
								);                                                                                                                                                                                                                                                     
							}                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
						});                                                                                                                                                                                                                                                      
						this.getView().getModel("TempModel").setProperty("/Locations", aTempData);                                                                                                                                                                               
						this.getView().getModel().setProperty(oSource.getBindingContext().getPath() + "/Changed", "X");                                                                                                                                                          
						this.getView().getModel("GlobalModel").setProperty(                                                                                                                                                                                                      
							`/S${oSource.getBindingContext().getObject().PurchaseOrder}${oSource.getBindingContext().getObject().PurchaseOrderLine}`,                                                                                                                               
							sValue                                                                                                                                                                                                                                                  
						);                                                                                                                                                                                                                                                       
					})                                                                                                                                                                                                                                                        
					.catch((oError) => {                                                                                                                                                                                                                                      
						if (typeof oError === "object") {                                                                                                                                                                                                                        
							GenericElements.showDialog(this.getView().getModel("i18n").getResourceBundle().getText("Error"), oError.message, "OK", "Error");                                                                                                                        
						} else {                                                                                                                                                                                                                                                 
							GenericElements.showDialog(this.getView().getModel("i18n").getResourceBundle().getText("Error"), oError, "OK", "Error");                                                                                                                                
						}                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
					});                                                                                                                                                                                                                                                       
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		handleValueHelp: function (oEvent) {                                                                                                                                                                                                                         
			let sTerm = oEvent.getParameter("suggestValue");                                                                                                                                                                                                            
			if (!this._valueHelpDialog) {                                                                                                                                                                                                                               
				this._valueHelpDialog = sap.ui.xmlfragment(                                                                                                                                                                                                                
					"com.delaware.df5-mm-po-confirm-cp.view.Dialog",                                                                                                                                                                                                          
					this                                                                                                                                                                                                                                                      
				);                                                                                                                                                                                                                                                         
				this.getView().addDependent(this._valueHelpDialog);                                                                                                                                                                                                        
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
			let aFilters = [];                                                                                                                                                                                                                                          
			let oObject = oEvent.getSource().getBindingContext().getObject();                                                                                                                                                                                           
			this.getView().getModel("GlobalModel").setProperty("/TempSource", oEvent.getSource());                                                                                                                                                                      
			aFilters.push(new Filter({                                                                                                                                                                                                                                  
				filters: [                                                                                                                                                                                                                                                 
					new sap.ui.model.Filter('Plant', sap.ui.model.FilterOperator.EQ, oObject.Plant),                                                                                                                                                                          
					new sap.ui.model.Filter('Product', sap.ui.model.FilterOperator.EQ, oObject.Material)                                                                                                                                                                      
				],                                                                                                                                                                                                                                                         
				and: true                                                                                                                                                                                                                                                  
			}));                                                                                                                                                                                                                                                        
			if (sTerm) {                                                                                                                                                                                                                                                
				aFilters.push(new Filter("StorageLocation", sap.ui.model.FilterOperator.Contains, sTerm));                                                                                                                                                                 
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
			this._valueHelpDialog.getBinding("items").filter(aFilters);                                                                                                                                                                                                 
			this._valueHelpDialog.open();                                                                                                                                                                                                                               
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		_handleValueHelpSearch: function (oEvent) {                                                                                                                                                                                                                  
			let sValue = oEvent.getParameter("value");                                                                                                                                                                                                                  
			let sPlant = oEvent.getSource().getBinding("items").sFilterParams.substring(24, 28);                                                                                                                                                                        
			let sMaterial = oEvent.getSource().getBinding("items").sFilterParams.substring(58, oEvent.getSource().getBinding("items").sFilterParams.indexOf('%', 58));                                                                                                  
			let aFilters = [];                                                                                                                                                                                                                                          
			aFilters.push(new Filter({                                                                                                                                                                                                                                  
				filters: [                                                                                                                                                                                                                                                 
					new Filter('Plant', sap.ui.model.FilterOperator.EQ, sPlant),                                                                                                                                                                                              
					new Filter('Product', sap.ui.model.FilterOperator.EQ, sMaterial),                                                                                                                                                                                         
					new Filter('StorageLocation', sap.ui.model.FilterOperator.Contains, sValue)                                                                                                                                                                               
				],                                                                                                                                                                                                                                                         
				and: true                                                                                                                                                                                                                                                  
			}));                                                                                                                                                                                                                                                        
			                                                                                                                                                                                                                                                            
			oEvent.getSource().getBinding("items").filter(aFilters);                                                                                                                                                                                                    
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		_handleValueHelpClose: function (oEvent) {                                                                                                                                                                                                                   
			let aFilters = [];                                                                                                                                                                                                                                          
			let oSelectedItem = oEvent.getParameter("selectedItem");                                                                                                                                                                                                    
			let oSource = this.getView().getModel("GlobalModel").getProperty("/TempSource");                                                                                                                                                                            
			let oObject = oSource.getBindingContext().getObject();                                                                                                                                                                                                      
			aFilters.push(new Filter({                                                                                                                                                                                                                                  
				filters: [                                                                                                                                                                                                                                                 
					new sap.ui.model.Filter('PurchaseOrder', sap.ui.model.FilterOperator.EQ, oObject.PurchaseOrder),                                                                                                                                                          
					new sap.ui.model.Filter('PurchaseOrderLine', sap.ui.model.FilterOperator.EQ, oObject.PurchaseOrderLine)                                                                                                                                                   
				],                                                                                                                                                                                                                                                         
				and: true                                                                                                                                                                                                                                                  
			}));                                                                                                                                                                                                                                                        
			if (oSelectedItem) {                                                                                                                                                                                                                                        
				let oSource = this.getView().getModel("GlobalModel").getProperty("/TempSource");                                                                                                                                                                           
				let bOriginalValue = false;                                                                                                                                                                                                                                
				let sValue = oEvent.getParameter('selectedItem').getTitle();                                                                                                                                                                                               
				let aTempData = this.getView().getModel("TempModel").getProperty("/Locations");                                                                                                                                                                            
				let aOriginData = this.getView().getModel("TempModel").getProperty("/OriginalValues");                                                                                                                                                                     
				let sString = `S${oObject.PurchaseOrder}${oObject.PurchaseOrderLine}`;                                                                                                                                                                                     
				if (aOriginData.length > 0) {                                                                                                                                                                                                                              
					aOriginData.forEach((data) => {                                                                                                                                                                                                                           
						if (data.PO === sString && data.SLoc === sValue) {                                                                                                                                                                                                       
							bOriginalValue = true;                                                                                                                                                                                                                                  
						}                                                                                                                                                                                                                                                        
					});                                                                                                                                                                                                                                                       
				} else {                                                                                                                                                                                                                                                   
					aOriginData.push({                                                                                                                                                                                                                                        
						PO: sString,                                                                                                                                                                                                                                             
						SLoc: oObject.StorageLocation                                                                                                                                                                                                                            
					});                                                                                                                                                                                                                                                       
				}                                                                                                                                                                                                                                                          
				if (!bOriginalValue) {                                                                                                                                                                                                                                     
					aOriginData.push({                                                                                                                                                                                                                                        
						PO: sString,                                                                                                                                                                                                                                             
						SLoc: oObject.StorageLocation                                                                                                                                                                                                                            
					});                                                                                                                                                                                                                                                       
				}                                                                                                                                                                                                                                                          
				this.getData("/xDF5xC_POCONF_LIST", aFilters)                                                                                                                                                                                                              
					.then((oData) => {                                                                                                                                                                                                                                        
						oData.results.forEach((line) => {                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
							this.getView().getModel().setProperty(                                                                                                                                                                                                                  
								`/xDF5xC_POCONF_LIST(PurchaseOrder='${line.PurchaseOrder}',PurchaseOrderLine='${line.PurchaseOrderLine}',SupplierConfirmation='${line.SupplierConfirmation}')` +                                                                                       
								"/StorageLocation", sValue);                                                                                                                                                                                                                           
							if (bOriginalValue) {                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
								this.getView().getModel().setProperty(                                                                                                                                                                                                                 
									`/xDF5xC_POCONF_LIST(PurchaseOrder='${line.PurchaseOrder}',PurchaseOrderLine='${line.PurchaseOrderLine}',SupplierConfirmation='${line.SupplierConfirmation}')` +                                                                                      
									"/TempStoreLoc", "None");                                                                                                                                                                                                                             
							} else {                                                                                                                                                                                                                                                
								this.getView().getModel().setProperty(                                                                                                                                                                                                                 
									`/xDF5xC_POCONF_LIST(PurchaseOrder='${line.PurchaseOrder}',PurchaseOrderLine='${line.PurchaseOrderLine}',SupplierConfirmation='${line.SupplierConfirmation}')` +                                                                                      
									"/TempStoreLoc", "Warning");                                                                                                                                                                                                                          
							}                                                                                                                                                                                                                                                       
							if (!aTempData.includes(                                                                                                                                                                                                                                
									`/xDF5xC_POCONF_LIST(PurchaseOrder='${line.PurchaseOrder}',PurchaseOrderLine='${line.PurchaseOrderLine}',SupplierConfirmation='${line.SupplierConfirmation}')`                                                                                        
								)) {                                                                                                                                                                                                                                                   
								aTempData.push(                                                                                                                                                                                                                                        
									`/xDF5xC_POCONF_LIST(PurchaseOrder='${line.PurchaseOrder}',PurchaseOrderLine='${line.PurchaseOrderLine}',SupplierConfirmation='${line.SupplierConfirmation}')`                                                                                        
								);                                                                                                                                                                                                                                                     
							}                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
						});                                                                                                                                                                                                                                                      
						this.getView().getModel("TempModel").setProperty("/Locations", aTempData);                                                                                                                                                                               
						this.getView().getModel().setProperty(oSource.getBindingContext().getPath() + "/Changed", "X");                                                                                                                                                          
						this.getView().getModel("GlobalModel").setProperty(                                                                                                                                                                                                      
							`/S${oSource.getBindingContext().getObject().PurchaseOrder}${oSource.getBindingContext().getObject().PurchaseOrderLine}`,                                                                                                                               
							sValue                                                                                                                                                                                                                                                  
						);                                                                                                                                                                                                                                                       
					})                                                                                                                                                                                                                                                        
					.catch((oError) => {                                                                                                                                                                                                                                      
						if (typeof oError === "object") {                                                                                                                                                                                                                        
							GenericElements.showDialog(this.getView().getModel("i18n").getResourceBundle().getText("Error"), oError.message, "OK", "Error");                                                                                                                        
						} else {                                                                                                                                                                                                                                                 
							GenericElements.showDialog(this.getView().getModel("i18n").getResourceBundle().getText("Error"), oError, "OK", "Error");                                                                                                                                
						}                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
					});                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
			}                                                                                                                                                                                                                                                           
			//	oEvent.getSource().getBinding("items").filter([]);                                                                                                                                                                                                       
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onPriceChange: function (oEvent) {                                                                                                                                                                                                                           
			let oSource = oEvent.getSource(),                                                                                                                                                                                                                           
				sValue = oSource.getValue();                                                                                                                                                                                                                               
			let bOriginalValue = false;                                                                                                                                                                                                                                 
			let oObject = oSource.getBindingContext().getObject();                                                                                                                                                                                                      
			let aFilters = [];                                                                                                                                                                                                                                          
			sValue = parseFloat(sValue.replace(',', '.')).toFixed(2);                                                                                                                                                                                                   
			let aTempData = this.getView().getModel("TempModel").getProperty("/Prices");                                                                                                                                                                                
			let aOriginData = this.getView().getModel("TempModel").getProperty("/OriginalValues");                                                                                                                                                                      
			let sString = `P${oObject.PurchaseOrder}${oObject.PurchaseOrderLine}`;                                                                                                                                                                                      
			if (aOriginData.length > 0) {                                                                                                                                                                                                                               
				aOriginData.forEach((data) => {                                                                                                                                                                                                                            
					if (data.PO === sString && data.Price === sValue) {                                                                                                                                                                                                       
						bOriginalValue = true;                                                                                                                                                                                                                                   
					}                                                                                                                                                                                                                                                         
				});                                                                                                                                                                                                                                                        
			} else {                                                                                                                                                                                                                                                    
				aOriginData.push({                                                                                                                                                                                                                                         
					PO: sString,                                                                                                                                                                                                                                              
					Price: oObject.NetPrice                                                                                                                                                                                                                                   
				});                                                                                                                                                                                                                                                        
			}                                                                                                                                                                                                                                                           
			if (!bOriginalValue) {                                                                                                                                                                                                                                      
				aOriginData.push({                                                                                                                                                                                                                                         
					PO: sString,                                                                                                                                                                                                                                              
					Price: oObject.NetPrice                                                                                                                                                                                                                                   
				});                                                                                                                                                                                                                                                        
			}                                                                                                                                                                                                                                                           
			aFilters.push(new Filter({                                                                                                                                                                                                                                  
				filters: [                                                                                                                                                                                                                                                 
					new sap.ui.model.Filter('PurchaseOrder', sap.ui.model.FilterOperator.EQ, oObject.PurchaseOrder),                                                                                                                                                          
					new sap.ui.model.Filter('PurchaseOrderLine', sap.ui.model.FilterOperator.EQ, oObject.PurchaseOrderLine)                                                                                                                                                   
				],                                                                                                                                                                                                                                                         
				and: true                                                                                                                                                                                                                                                  
			}));                                                                                                                                                                                                                                                        
		                                                                                                                                                                                                                                                             
			this.getData("/xDF5xC_POCONF_LIST", aFilters)                                                                                                                                                                                                               
				.then((oData) => {                                                                                                                                                                                                                                         
					oData.results.forEach((line) => {                                                                                                                                                                                                                         
						this.getView().getModel().setProperty(                                                                                                                                                                                                                   
							`/xDF5xC_POCONF_LIST(PurchaseOrder='${line.PurchaseOrder}',PurchaseOrderLine='${line.PurchaseOrderLine}',SupplierConfirmation='${line.SupplierConfirmation}')` +                                                                                        
							"/NetPrice", sValue);                                                                                                                                                                                                                                   
						if (bOriginalValue) {                                                                                                                                                                                                                                    
							this.getView().getModel().setProperty(                                                                                                                                                                                                                  
								`/xDF5xC_POCONF_LIST(PurchaseOrder='${line.PurchaseOrder}',PurchaseOrderLine='${line.PurchaseOrderLine}',SupplierConfirmation='${line.SupplierConfirmation}')` +                                                                                       
								"/TempNetPr", "None");                                                                                                                                                                                                                                 
						} else {                                                                                                                                                                                                                                                 
							this.getView().getModel().setProperty(                                                                                                                                                                                                                  
								`/xDF5xC_POCONF_LIST(PurchaseOrder='${line.PurchaseOrder}',PurchaseOrderLine='${line.PurchaseOrderLine}',SupplierConfirmation='${line.SupplierConfirmation}')` +                                                                                       
								"/TempNetPr", "Warning");                                                                                                                                                                                                                              
						}                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
						if (!aTempData.includes(                                                                                                                                                                                                                                 
								`/xDF5xC_POCONF_LIST(PurchaseOrder='${line.PurchaseOrder}',PurchaseOrderLine='${line.PurchaseOrderLine}',SupplierConfirmation='${line.SupplierConfirmation}')`                                                                                         
							)) {                                                                                                                                                                                                                                                    
							aTempData.push(                                                                                                                                                                                                                                         
								`/xDF5xC_POCONF_LIST(PurchaseOrder='${line.PurchaseOrder}',PurchaseOrderLine='${line.PurchaseOrderLine}',SupplierConfirmation='${line.SupplierConfirmation}')`                                                                                         
							);                                                                                                                                                                                                                                                      
						}                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
					});                                                                                                                                                                                                                                                       
					this.getView().getModel("TempModel").setProperty("/Prices", aTempData);                                                                                                                                                                                   
					this.getView().getModel().setProperty(oSource.getBindingContext().getPath() + "/Changed", "X");                                                                                                                                                           
					this.getView().getModel("GlobalModel").setProperty(                                                                                                                                                                                                       
						`/P${oSource.getBindingContext().getObject().PurchaseOrder}${oSource.getBindingContext().getObject().PurchaseOrderLine}`,                                                                                                                                
						sValue                                                                                                                                                                                                                                                   
					);                                                                                                                                                                                                                                                        
				})                                                                                                                                                                                                                                                         
				.catch((oError) => {                                                                                                                                                                                                                                       
					GenericElements.showDialog(this.getView().getModel("i18n").getResourceBundle().getText("Error"), oError, "OK", "Error");                                                                                                                                  
				});                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onDelDateChange: function (oEvent) {                                                                                                                                                                                                                         
			let oSource = oEvent.getSource(),                                                                                                                                                                                                                           
				sValue = oSource.getValue();                                                                                                                                                                                                                               
			let dValue = this.oFormatter.formatDate(sValue);                                                                                                                                                                                                            
			let bValid = oEvent.getParameter("valid");                                                                                                                                                                                                                  
			if (dValue !== 'Invalid Date' && bValid) {                                                                                                                                                                                                                  
				this.getView().getModel().setProperty(oSource.getBindingContext().getPath() + "/ConfirmedDelDate", dValue);                                                                                                                                                
			} else {                                                                                                                                                                                                                                                    
				let dOldDate = formatter.formatSAPDate(this.getView().getModel().getProperty(oSource.getBindingContext().getPath() +                                                                                                                                       
					"/ConfirmedDelDate"));                                                                                                                                                                                                                                    
				oSource.setValue(dOldDate);                                                                                                                                                                                                                                
				GenericElements.showDialog(this.getView().getModel("i18n").getResourceBundle().getText("Error"), this.getView().getModel("i18n").getResourceBundle()                                                                                                       
					.getText("InvalidDate"), "OK", "Error");                                                                                                                                                                                                                  
			}                                                                                                                                                                                                                                                           
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		onReferenceChange: function (oEvent) {                                                                                                                                                                                                                       
			let oSource = oEvent.getSource(),                                                                                                                                                                                                                           
				sValue = oSource.getValue();                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
			this.getView().getModel().setProperty(oSource.getBindingContext().getPath() + "/Reference", sValue);                                                                                                                                                        
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		handleConfirm: function (oEvent) {                                                                                                                                                                                                                           
			let aSelectedItems = []; //oEvent.getSource().getParent().getParent().getSelectedItems();                                                                                                                                                                   
			this._aPO = [];                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
			let aSelectedIndices = oEvent.getSource().getParent().getParent().getSelectedIndices();                                                                                                                                                                     
			this._oTable = oEvent.getSource().getParent().getParent();                                                                                                                                                                                                  
			if (aSelectedIndices.length === 0) {                                                                                                                                                                                                                        
				GenericElements.showDialog(this.getView().getModel("i18n").getResourceBundle().getText("Error"), this.getView().getModel("i18n").getResourceBundle()                                                                                                       
					.getText("NoItems"), "OK", "Error");                                                                                                                                                                                                                      
			} else {                                                                                                                                                                                                                                                    
				this.getView().setBusy(true);                                                                                                                                                                                                                              
				aSelectedIndices.forEach((index) => {                                                                                                                                                                                                                      
					let indexObj = oEvent.getSource().getParent().getParent().getContextByIndex(index).getObject();                                                                                                                                                           
					aSelectedItems.push(indexObj);                                                                                                                                                                                                                            
					this._aPO.push({ PurchaseOrder: indexObj.PurchaseOrder, PurchaseOrderLine: indexObj.PurchaseOrderLine });                                                                                                                                                 
				});                                                                                                                                                                                                                                                        
				let aItems = [];                                                                                                                                                                                                                                           
				let aExistingitems = [];                                                                                                                                                                                                                                   
				let aGlobalFilters = [];                                                                                                                                                                                                                                   
				let sPo;                                                                                                                                                                                                                                                   
				let oDummyObject;                                                                                                                                                                                                                                          
				aSelectedItems.forEach((oObject) => {                                                                                                                                                                                                                      
					delete oObject.TempStoreLoc;                                                                                                                                                                                                                              
					delete oObject.TempNetPr;                                                                                                                                                                                                                                 
					oObject.Quantity = oObject.Quantity.toString();                                                                                                                                                                                                           
					oDummyObject = oObject;                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
					aGlobalFilters.push(new Filter({                                                                                                                                                                                                                          
						filters: [                                                                                                                                                                                                                                               
							new sap.ui.model.Filter('PurchaseOrder', sap.ui.model.FilterOperator.EQ, oObject.PurchaseOrder),                                                                                                                                                        
							new sap.ui.model.Filter('PurchaseOrderLine', sap.ui.model.FilterOperator.EQ, oObject.PurchaseOrderLine)                                                                                                                                                 
						],                                                                                                                                                                                                                                                       
						and: true                                                                                                                                                                                                                                                
					}));                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
					if (oObject.SupplierConfirmation === "" || oObject.SupplierConfirmation === "0") {                                                                                                                                                                        
						aItems.push(oObject);                                                                                                                                                                                                                                    
						this.getView().getModel("GlobalModel").setProperty(`/C${oObject.PurchaseOrder}${oObject.PurchaseOrderLine}`, true);                                                                                                                                      
					} else {                                                                                                                                                                                                                                                  
						aExistingitems.push(oObject);                                                                                                                                                                                                                            
					}                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
					sPo = oObject.PurchaseOrder;                                                                                                                                                                                                                              
				});                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
				this.getData("/xDF5xC_SUPPLIERCONFIRMATION", aGlobalFilters)                                                                                                                                                                                               
					.then((oData) => {                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
						oData.results.forEach((line) => {                                                                                                                                                                                                                        
							aExistingitems.forEach((newLine) => {                                                                                                                                                                                                                   
								let bChange = this.getView().getModel("GlobalModel").getProperty(                                                                                                                                                                                      
									`/C${newLine.PurchaseOrder}${newLine.PurchaseOrderLine}`);                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
								if (line.PurchaseOrder === newLine.PurchaseOrder && line.PurchaseOrderLine === newLine.PurchaseOrderLine && line.SupplierConfirmation ===                                                                                                              
									newLine.SupplierConfirmation) {                                                                                                                                                                                                                       
									line.Quantity = newLine.Quantity;                                                                                                                                                                                                                     
									line.NetPrice = newLine.NetPrice;                                                                                                                                                                                                                     
									line.ConfirmedDelDate = newLine.ConfirmedDelDate;                                                                                                                                                                                                     
									line.Reference = newLine.Reference;                                                                                                                                                                                                                   
									line.StorageLocation = newLine.StorageLocation;                                                                                                                                                                                                       
									if (bChange !== true) {                                                                                                                                                                                                                               
										line.Changed = newLine.Changed;                                                                                                                                                                                                                      
										this.getView().getModel("GlobalModel").setProperty(`/C${newLine.PurchaseOrder}${newLine.PurchaseOrderLine}`, true);                                                                                                                                  
									}                                                                                                                                                                                                                                                     
								}                                                                                                                                                                                                                                                      
							});                                                                                                                                                                                                                                                     
							let oDummy = { ...oDummyObject };                                                                                                                                                                                                                       
							oDummy.Quantity = line.Quantity;                                                                                                                                                                                                                        
							oDummy.NetPrice = line.NetPrice;                                                                                                                                                                                                                        
							oDummy.ConfirmedDelDate = line.ConfirmedDelDate;                                                                                                                                                                                                        
							oDummy.Reference = line.Reference;                                                                                                                                                                                                                      
							oDummy.StorageLocation = line.StorageLocation;                                                                                                                                                                                                          
							oDummy.PurchaseOrder = line.PurchaseOrder;                                                                                                                                                                                                              
							oDummy.PurchaseOrderLine = line.PurchaseOrderLine                                                                                                                                                                                                       
							oDummy.SupplierConfirmation = line.SupplierConfirmation;                                                                                                                                                                                                
							oDummy.Material = line.Material;                                                                                                                                                                                                                        
							oDummy.Changed = line.Changed;                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
							aItems.unshift(oDummy);                                                                                                                                                                                                                                 
						});                                                                                                                                                                                                                                                      
						let oPayload = {                                                                                                                                                                                                                                         
							to_ConfLines: [{                                                                                                                                                                                                                                        
								purchaseorder: sPo,                                                                                                                                                                                                                                    
								to_Lines: aItems,                                                                                                                                                                                                                                      
								to_Log: []                                                                                                                                                                                                                                             
							}]                                                                                                                                                                                                                                                      
						};                                                                                                                                                                                                                                                       
						return this.POSTData(this, "xDF5xC_ACTIONID", oPayload);                                                                                                                                                                                                 
					})                                                                                                                                                                                                                                                        
					.then((oResponse) => {                                                                                                                                                                                                                                    
						let aErrors = [];                                                                                                                                                                                                                                        
						let aConfLines = oResponse.to_ConfLines.results;                                                                                                                                                                                                         
						aConfLines.forEach((line) => {                                                                                                                                                                                                                           
							line.to_Log.results.forEach((logLine) => {                                                                                                                                                                                                              
								if (logLine.ztype === 'E' || logLine.ztype === 'E') {                                                                                                                                                                                                  
									aErrors.push(logLine.zmessage);                                                                                                                                                                                                                       
								}                                                                                                                                                                                                                                                      
							});                                                                                                                                                                                                                                                     
						});                                                                                                                                                                                                                                                      
						if (aErrors.length > 0) {                                                                                                                                                                                                                                
							let sDetails = "";                                                                                                                                                                                                                                      
							aErrors.forEach((error) => {                                                                                                                                                                                                                            
								sDetails = sDetails + `<li>${error}</li>`;                                                                                                                                                                                                             
							});                                                                                                                                                                                                                                                     
							MessageBox.error(this.getView().getModel("i18n").getResourceBundle().getText("ErrorDuringConfirmation"), {                                                                                                                                              
								title: this.getView().getModel("i18n").getResourceBundle().getText("Error"),                                                                                                                                                                           
								id: "messageBoxId1",                                                                                                                                                                                                                                   
								details: `<ul>                                                                                                                                                                                                                                         
								${sDetails}                                                                                                                                                                                                                                            
								</ul>`                                                                                                                                                                                                                                                 
							});                                                                                                                                                                                                                                                     
							this.getView().getModel().refresh();                                                                                                                                                                                                                    
						} else {                                                                                                                                                                                                                                                 
							GenericElements.showDialog(this.getView().getModel("i18n").getResourceBundle().getText("Success"),                                                                                                                                                      
													   this.getView().getModel("i18n").getResourceBundle().getText("ConfOk"),                                                                                                                                                                         
													   "OK",                                                                                                                                                                                                                                          
													   "Success");                                                                                                                                                                                                                                    
							//this.getView().getModel().updateBindings();                                                                                                                                                                                                           
							let aLocations = this.getView().getModel("TempModel").getProperty("/Locations");                                                                                                                                                                        
							let aPrices = this.getView().getModel("TempModel").getProperty("/Prices");                                                                                                                                                                              
							if (aLocations.length > 0) {                                                                                                                                                                                                                            
								aLocations.forEach((location) => {                                                                                                                                                                                                                     
									this.getView().getModel().setProperty(                                                                                                                                                                                                                
										location + "/TempStoreLoc", "None");                                                                                                                                                                                                                 
								});                                                                                                                                                                                                                                                    
							}                                                                                                                                                                                                                                                       
							if (aPrices.length > 0) {                                                                                                                                                                                                                               
								aPrices.forEach((price) => {                                                                                                                                                                                                                           
									this.getView().getModel().setProperty(                                                                                                                                                                                                                
										price + "/TempNetPr", "None");                                                                                                                                                                                                                       
								});                                                                                                                                                                                                                                                    
							}                                                                                                                                                                                                                                                       
							this.getView().getModel().refresh();                                                                                                                                                                                                                    
							                                                                                                                                                                                                                                                        
							let aFilters = [];                                                                                                                                                                                                                                      
							this._aPO.forEach(oPO => {                                                                                                                                                                                                                              
								aFilters.push(new Filter({                                                                                                                                                                                                                             
									filters: [                                                                                                                                                                                                                                            
										new sap.ui.model.Filter('PurchaseOrder', sap.ui.model.FilterOperator.EQ, oPO.PurchaseOrder),                                                                                                                                                         
										new sap.ui.model.Filter('PurchaseOrderLine', sap.ui.model.FilterOperator.EQ, oPO.PurchaseOrderLine)                                                                                                                                                  
									],                                                                                                                                                                                                                                                    
									and: true                                                                                                                                                                                                                                             
								}));                                                                                                                                                                                                                                                   
							});                                                                                                                                                                                                                                                     
							                                                                                                                                                                                                                                                        
							this.getData("/xDF5xC_POCONF_LIST", aFilters)                                                                                                                                                                                                           
								.then((oData) => {                                                                                                                                                                                                                                     
									oData.results.forEach((line) => {                                                                                                                                                                                                                     
										this.getView().getModel().setProperty(                                                                                                                                                                                                               
											`/xDF5xC_POCONF_LIST(PurchaseOrder='${line.PurchaseOrder}',PurchaseOrderLine='${line.PurchaseOrderLine}',SupplierConfirmation='${line.SupplierConfirmation}')` +                                                                                    
											"/Quantity", line.Quantity);                                                                                                                                                                                                                        
									});                                                                                                                                                                                                                                                   
								});                                                                                                                                                                                                                                                    
							                                                                                                                                                                                                                                                        
							this._oTable.setSelectedIndex(-1);                                                                                                                                                                                                                      
						}                                                                                                                                                                                                                                                        
						this.getView().getModel("TempModel").setProperty("/Locations", []);                                                                                                                                                                                      
						this.getView().getModel("TempModel").setProperty("/Prices", []);                                                                                                                                                                                         
						this.getView().getModel("TempModel").setProperty("/OriginalValues", []);                                                                                                                                                                                 
						this.getView().setBusy(false);                                                                                                                                                                                                                           
					})                                                                                                                                                                                                                                                        
					.catch((oError) => {                                                                                                                                                                                                                                      
						console.log(oError);                                                                                                                                                                                                                                     
						GenericElements.showDialog(this.getView().getModel("i18n").getResourceBundle().getText("Error"),                                                                                                                                                         
												   this.getView().getModel("i18n").getResourceBundle().getText("ErrorDuringConfirmation"),                                                                                                                                                         
												   "OK",                                                                                                                                                                                                                                           
												   "Error");                                                                                                                                                                                                                                       
						this.getView().setBusy(false);                                                                                                                                                                                                                           
						this.getView().getModel().refresh();                                                                                                                                                                                                                     
					});                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		POSTData: function (that, serviceExtend, oPayload) {                                                                                                                                                                                                         
			return new Promise(function (resolve, reject) {                                                                                                                                                                                                             
				let sUrl = "/" + serviceExtend;                                                                                                                                                                                                                            
				let oModel = that.getView().getModel();                                                                                                                                                                                                                    
				oModel.create(sUrl, oPayload, {                                                                                                                                                                                                                            
					success: function (oData, response) {                                                                                                                                                                                                                     
						resolve(oData, response);                                                                                                                                                                                                                                
						that.getView().setBusy(false);                                                                                                                                                                                                                           
					},                                                                                                                                                                                                                                                        
					error: function (oError) {                                                                                                                                                                                                                                
						reject(oError);                                                                                                                                                                                                                                          
						that.getView().setBusy(false);                                                                                                                                                                                                                           
					}                                                                                                                                                                                                                                                         
				});                                                                                                                                                                                                                                                        
			});                                                                                                                                                                                                                                                         
		},                                                                                                                                                                                                                                                           
		getData: function (sUrl, aFilters) {                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
			let oModel = this.getOwnerComponent().getModel();                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
			return new Promise((resolve, reject) => {                                                                                                                                                                                                                   
				oModel.read(sUrl, {                                                                                                                                                                                                                                        
					filters: [new sap.ui.model.Filter(aFilters, false)],                                                                                                                                                                                                      
					success: (oData) => {                                                                                                                                                                                                                                     
						resolve(oData);                                                                                                                                                                                                                                          
					},                                                                                                                                                                                                                                                        
					error: (error) => {                                                                                                                                                                                                                                       
						reject(error);                                                                                                                                                                                                                                           
					}                                                                                                                                                                                                                                                         
				});                                                                                                                                                                                                                                                        
			});                                                                                                                                                                                                                                                         
		},                                                                                                                                                                                                                                                           
		                                                                                                                                                                                                                                                             
		onBeforeExport: function (oEvent) {                                                                                                                                                                                                                          
			let mExcelSettings = oEvent.getParameters("exportSettings");                                                                                                                                                                                                
			                                                                                                                                                                                                                                                            
			for (let column of mExcelSettings.exportSettings.workbook.columns)                                                                                                                                                                                          
			{                                                                                                                                                                                                                                                           
				if (column.property=="ConfirmedDelDate")                                                                                                                                                                                                                   
				{                                                                                                                                                                                                                                                          
					column.type="date";                                                                                                                                                                                                                                       
				}                                                                                                                                                                                                                                                          
			}                                                                                                                                                                                                                                                           
		}                                                                                                                                                                                                                                                            
	});                                                                                                                                                                                                                                                           
});                                                                                                                                                                                                                                                            